!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self)["vue-authenticate"]=e()}(this,function(){"use strict";function o(t){return void 0===t}function i(t){return"function"==typeof t}function a(e,o){return null==e||null==o||Object.keys(o).forEach(function(t){"[object Object]"!=Object.prototype.toString.call(o[t])||"[object Object]"!=Object.prototype.toString.call(e[t])?e[t]=o[t]:e[t]=a(e[t],o[t])}),e}function n(t,e){if(/^(?:[a-z]+:)?\/\//i.test(e))return e;return[t,e].join("/").replace(/[\/]+/g,"/").replace(/\/\?/g,"?").replace(/\/\#/g,"#").replace(/\:\//g,"://")}function p(t){var e="https:"===t.protocol;return t.protocol+"//"+t.hostname+":"+(t.port||(e?"443":"80"))+(/^\//.test(t.pathname)?t.pathname:"/"+t.pathname)}function h(t){let e={},o,r;return(t||"").split("&").forEach(t=>{t&&(r=t.split("="),o=decodeURIComponent(r[0]),e[o]=!r[1]||decodeURIComponent(r[1]))}),e}function r(t){let e;if("undefined"!=typeof module&&module.exports)try{e=require("buffer").Buffer}catch(t){}let o=String.fromCharCode,r=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),i=function(t){switch(t.length){case 4:var e=((7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3))-65536;return o(55296+(e>>>10))+o(56320+(1023&e));case 3:return o((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return o((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},n=e?function(t){return(t.constructor===e.constructor?t:new e(t,"base64")).toString()}:function(t){return atob(t).replace(r,i)};return n(String(t).replace(/[-_]/g,function(t){return"-"===t?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))}function s(t,e,o){return[encodeURIComponent(t),"=",encodeURIComponent(e),function(t){const{path:e,domain:o,expires:r,secure:i}=t;return[null==e?"":";path="+e,null==o?"":";domain="+o,void 0===r||null===r?"":";expires="+r.toUTCString(),null==i||!1===i?"":";secure"].join("")}(o)].join("")}"function"!=typeof Object.assign&&(Object.assign=function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var o=Object(t),r=1;r<arguments.length;r++){var i=arguments[r];if(null!=i)for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(o[n]=i[n])}return o});const u=document,l=window;function e(){try{return l.location.hostname}catch(t){}return""}function t(t){try{return o(t)?l.location.origin:`${l.location.origin}${t}`}catch(t){}return t||null}var c={baseUrl:null,tokenPath:"access_token",tokenName:"token",tokenPrefix:"vueauth",tokenHeader:"Authorization",tokenType:"Bearer",loginUrl:"/auth/login",registerUrl:"/auth/register",logoutUrl:null,storageType:"localStorage",storageNamespace:"vue-authenticate",cookieStorage:{domain:e(),path:"/",secure:!1},requestDataKey:"data",responseDataKey:"data",bindRequestInterceptor:function(e){const o=e.options.tokenHeader;e.$http.interceptors.request.use(t=>(e.isAuthenticated()?t.headers[o]=[e.options.tokenType,e.getToken()].join(" "):delete t.headers[o],t))},providers:{facebook:{name:"facebook",url:"/auth/facebook",authorizationEndpoint:"https://www.facebook.com/v10.0/dialog/oauth",redirectUri:t("/"),requiredUrlParams:["display","scope"],scope:["email"],scopeDelimiter:",",display:"popup",oauthType:"2.0",popupOptions:{width:580,height:400}},google:{name:"google",url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:t(),requiredUrlParams:["scope"],optionalUrlParams:["display"],scope:["profile","email"],scopePrefix:"openid",scopeDelimiter:" ",display:"popup",oauthType:"2.0",popupOptions:{width:452,height:633}},github:{name:"github",url:"/auth/github",authorizationEndpoint:"https://github.com/login/oauth/authorize",redirectUri:t(),optionalUrlParams:["scope"],scope:["user:email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:1020,height:618}},instagram:{name:"instagram",url:"/auth/instagram",authorizationEndpoint:"https://api.instagram.com/oauth/authorize",redirectUri:t(),requiredUrlParams:["scope"],scope:["basic"],scopeDelimiter:"+",oauthType:"2.0",popupOptions:{width:null,height:null}},twitter:{name:"twitter",url:"/auth/twitter",authorizationEndpoint:"https://api.twitter.com/oauth/authenticate",redirectUri:t(),oauthType:"1.0",popupOptions:{width:495,height:645}},bitbucket:{name:"bitbucket",url:"/auth/bitbucket",authorizationEndpoint:"https://bitbucket.org/site/oauth2/authorize",redirectUri:t("/"),optionalUrlParams:["scope"],scope:["email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:1020,height:618}},linkedin:{name:"linkedin",url:"/auth/linkedin",authorizationEndpoint:"https://www.linkedin.com/oauth/v2/authorization",redirectUri:t(),requiredUrlParams:["state"],scope:["r_emailaddress"],scopeDelimiter:" ",state:"STATE",oauthType:"2.0",popupOptions:{width:527,height:582}},live:{name:"live",url:"/auth/live",authorizationEndpoint:"https://login.live.com/oauth20_authorize.srf",redirectUri:t(),requiredUrlParams:["display","scope"],scope:["wl.emails"],scopeDelimiter:" ",display:"popup",oauthType:"2.0",popupOptions:{width:500,height:560}},oauth1:{name:null,url:"/auth/oauth1",authorizationEndpoint:null,redirectUri:t(),oauthType:"1.0",popupOptions:null},oauth2:{name:null,url:"/auth/oauth2",clientId:null,redirectUri:t(),authorizationEndpoint:null,defaultUrlParams:["response_type","client_id","redirect_uri"],requiredUrlParams:null,optionalUrlParams:null,scope:null,scopePrefix:null,scopeDelimiter:null,state:null,oauthType:"2.0",popupOptions:null,responseType:"code",responseParams:{code:"code",clientId:"clientId",redirectUri:"redirectUri"}}}};class d{constructor(t){this._defaultOptions=a({domain:e(),expires:null,path:"/",secure:!1},t)}setItem(t,e){e=s(t,e,a({},this._defaultOptions));this._setCookie(e)}getItem(t){const e=function(t=""){if(0===t.length)return{};const o={};var e=new RegExp("\\s*;\\s*");return t.split(e).forEach(t=>{var[e,t]=t.split("="),e=decodeURIComponent(e),t=decodeURIComponent(t);o[e]=t}),o}(this._getCookie());return e.hasOwnProperty(t)?e[t]:null}removeItem(t){var e=a({},this._defaultOptions),e=s(t,"",a(e,{expires:new Date(0)}));this._setCookie(e)}_getCookie(){try{return"undefined"===u.cookie?"":u.cookie}catch(t){}return""}_setCookie(t){try{u.cookie=t}catch(t){}}}class g{constructor(t){this.namespace=t||null}setItem(t,e){l.localStorage.setItem(this._getStorageKey(t),e)}getItem(t){return l.localStorage.getItem(this._getStorageKey(t))}removeItem(t){l.localStorage.removeItem(this._getStorageKey(t))}_getStorageKey(t){return this.namespace?[this.namespace,t].join("."):t}}class m{constructor(t){this.namespace=t||null,this._storage={}}setItem(t,e){this._storage[this._getStorageKey(t)]=e}getItem(t){return this._storage[this._getStorageKey(t)]}removeItem(t){delete this._storage[this._getStorageKey(t)]}_getStorageKey(t){return this.namespace?[this.namespace,t].join("."):t}}class f{constructor(t){this.namespace=t||null}setItem(t,e){l.sessionStorage.setItem(this._getStorageKey(t),e)}getItem(t){return l.sessionStorage.getItem(this._getStorageKey(t))}removeItem(t){l.sessionStorage.removeItem(this._getStorageKey(t))}_getStorageKey(t){return this.namespace?[this.namespace,t].join("."):t}}class y{constructor(t,e,o){this.popup=null,this.url=t,this.name=e,this.popupOptions=o}async open(t,e){try{if(this.popup=l.open(this.url,this.name,this._stringifyOptions()),this.popup&&this.popup.focus&&this.popup.focus(),!e)return this.pooling(t)}catch(t){throw new Error("OAuth popup error occurred")}}async pooling(e){return new Promise((r,i)=>{const t=u.createElement("a");t.href=e;const n=p(t);let s=setInterval(()=>{if(!this.popup||this.popup.closed||void 0===this.popup.closed)throw clearInterval(s),s=null,new Error("Auth popup window closed");try{var t,e,o;p(this.popup.location)===n&&(this.popup.location.search||this.popup.location.hash?(t=h(this.popup.location.search.substring(1).replace(/\/$/,"")),e=h(this.popup.location.hash.substring(1).replace(/[\/$]/,"")),o=a({},t),(o=a(o,e)).error?i(new Error(o.error)):r(o),clearInterval(s),s=null,this.popup.close()):i(new Error("OAuth redirect has occurred but no query or hash parameters were found.")))}catch(t){}},250)})}_stringifyOptions(){let t=[];for(var e in this.popupOptions)o(this.popupOptions[e])||t.push(`${e}=${this.popupOptions[e]}`);return t.join(",")}}const v={name:null,url:null,authorizationEndpoint:null,scope:null,scopePrefix:null,scopeDelimiter:null,redirectUri:null,requiredUrlParams:null,defaultUrlParams:null,oauthType:"1.0",popupOptions:{}};class w{constructor(t,e,o,r){this.$http=t,this.storage=e,this.providerConfig=a({},v),this.providerConfig=a(this.providerConfig,o),this.options=r}async init(t){this.oauthPopup=new y("about:blank",this.providerConfig.name,this.providerConfig.popupOptions),l.cordova||this.oauthPopup.open(this.providerConfig.redirectUri,!0);var e=await this.getRequestToken(),e=await this.openPopup(e);return this.exchangeForToken(e,t)}async getRequestToken(){let t={method:"POST"};return t[this.options.requestDataKey]=a({},this.providerConfig),t.withCredentials=this.options.withCredentials,this.options.baseUrl?t.url=n(this.options.baseUrl,this.providerConfig.url):t.url=this.providerConfig.url,this.$http(t)}async openPopup(t){t=[this.providerConfig.authorizationEndpoint,this.buildQueryString(t[this.options.responseDataKey])].join("?");return this.oauthPopup.popup.location=t,l.cordova?this.oauthPopup.open(this.providerConfig.redirectUri):this.oauthPopup.pooling(this.providerConfig.redirectUri)}async exchangeForToken(t,e){e=a({},e),e=a(e,t);let o={method:"POST"};return o[this.options.requestDataKey]=e,o.withCredentials=this.options.withCredentials,this.options.baseUrl?o.url=n(this.options.baseUrl,this.providerConfig.url):o.url=this.providerConfig.url,this.$http(o)}buildQueryString(t){const e=[];for(var o in t){var r=t[o];e.push(encodeURIComponent(o)+"="+encodeURIComponent(r))}return e.join("&")}}const C={name:null,url:null,clientId:null,authorizationEndpoint:null,redirectUri:null,scope:null,scopePrefix:null,scopeDelimiter:null,state:null,requiredUrlParams:null,defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"code",responseParams:{code:"code",clientId:"clientId",redirectUri:"redirectUri"},oauthType:"2.0",popupOptions:{}};class b{constructor(t,e,o,r){this.$http=t,this.storage=e,this.providerConfig=a({},C),this.providerConfig=a(this.providerConfig,o),this.options=r}async init(t){var e=this.providerConfig.name+"_state";i(this.providerConfig.state)?this.storage.setItem(e,this.providerConfig.state()):"string"==typeof this.providerConfig.state&&this.storage.setItem(e,this.providerConfig.state);var o=[this.providerConfig.authorizationEndpoint,this._stringifyRequestParams()].join("?");const r=new y(o,this.providerConfig.name,this.providerConfig.popupOptions);o=await r.open(this.providerConfig.redirectUri);if("token"===this.providerConfig.responseType||!this.providerConfig.url)return o;if(o.state&&o.state!==this.storage.getItem(e))throw new Error("State parameter value does not match original OAuth request state value");return this.exchangeForToken(o,t)}exchangeForToken(t,e){let o=a({},e);for(var r in this.providerConfig.responseParams)switch(this.providerConfig.responseParams[r],r){case"code":o[r]=t.code;break;case"clientId":o[r]=this.providerConfig.clientId;break;case"redirectUri":o[r]=this.providerConfig.redirectUri;break;default:o[r]=t[r]}t.state&&(o.state=t.state);let i;return i=this.options.baseUrl?n(this.options.baseUrl,this.providerConfig.url):this.providerConfig.url,this.$http.post(i,o,{withCredentials:this.options.withCredentials})}_stringifyRequestParams(){let r=[];return["defaultUrlParams","requiredUrlParams","optionalUrlParams"].forEach(t=>{this.providerConfig[t]&&Array.isArray(this.providerConfig[t])&&this.providerConfig[t].forEach(t=>{var e=t.replace(/([\:\-\_]+(.))/g,function(t,e,o,r){return r?o.toUpperCase():o});let o=i(this.providerConfig[t])?this.providerConfig[t]():this.providerConfig[e];"redirect_uri"===t&&!o||("state"===t&&(e=this.providerConfig.name+"_state",o=encodeURIComponent(this.storage.getItem(e))),"scope"===t&&Array.isArray(o)&&(o=o.join(this.providerConfig.scopeDelimiter),this.providerConfig.scopePrefix&&(o=[this.providerConfig.scopePrefix,o].join(this.providerConfig.scopeDelimiter))),r.push([t,o]))})}),r.map(t=>t.join("=")).join("&")}}class k{constructor(t,e){let o=a({},c);o=a(o,e);let r=function(t){switch(t.storageType){case"localStorage":try{return l.localStorage.setItem("testKey","test"),l.localStorage.removeItem("testKey"),new g(t.storageNamespace)}catch(t){}case"sessionStorage":try{return l.sessionStorage.setItem("testKey","test"),l.sessionStorage.removeItem("testKey"),new f(t.storageNamespace)}catch(t){}case"cookieStorage":return new d(t.cookieStorage);case"memoryStorage":default:return new m(t.storageNamespace)}}(o);if(Object.defineProperties(this,{$http:{get(){return t}},options:{get(){return o}},storage:{get(){return r}},tokenName:{get(){return this.options.tokenPrefix?[this.options.tokenPrefix,this.options.tokenName].join("_"):this.options.tokenName}}}),!this.options.bindRequestInterceptor||!i(this.options.bindRequestInterceptor))throw new Error("Request interceptor must be functions");this.options.bindRequestInterceptor.call(this,this)}isAuthenticated(){let t=this.storage.getItem(this.tokenName);if(t){if(3===t.split(".").length)try{const r=t.split(".")[1];var e=r.replace("-","+").replace("_","/"),o=JSON.parse(l.atob(e)).exp;if("number"==typeof o)return Math.round((new Date).getTime()/1e3)<o}catch(t){return!0}return!0}return!1}getToken(){return this.storage.getItem(this.tokenName)}setToken(t,e){e=function(t,e){let o=void 0,r=t;for(var i,n=e.split("."),s=0;s<n.length;s++){var a=n[s];if(o=r[a],null===(i=o)||"object"!=typeof i)break;r=r[a]}return o}(t=t[this.options.responseDataKey]?t[this.options.responseDataKey]:t,e||this.options.tokenPath);e&&this.storage.setItem(this.tokenName,e)}getPayload(){const t=this.storage.getItem(this.tokenName);if(t&&3===t.split(".").length)try{const o=t.split(".")[1];var e=o.replace("-","+").replace("_","/");return JSON.parse(r(e))}catch(t){}}async login(t,e){(e=e||{}).url=e.url||n(this.options.baseUrl,this.options.loginUrl),e[this.options.requestDataKey]=t||e[this.options.requestDataKey],e.method=e.method||"POST",e.withCredentials=e.withCredentials||this.options.withCredentials;e=this.$http(e);return this.setToken(e),e}async register(t,e){(e=e||{}).url=e.url||n(this.options.baseUrl,this.options.registerUrl),e[this.options.requestDataKey]=t||e[this.options.requestDataKey],e.method=e.method||"POST",e.withCredentials=e.withCredentials||this.options.withCredentials;e=this.$http(e);return this.setToken(e),e}async logout(t){if(!this.isAuthenticated())throw new Error("There is no currently authenticated user");if((t=t||{}).url||this.options.logoutUrl){t.url=t.url||n(this.options.baseUrl,this.options.logoutUrl),t.method=t.method||"POST",t[this.options.requestDataKey]=t[this.options.requestDataKey]||void 0,t.withCredentials=t.withCredentials||this.options.withCredentials;t=this.$http(t);return this.storage.removeItem(this.tokenName),t}this.storage.removeItem(this.tokenName)}async authenticate(t,e,o){var r=this.options.providers[t];if(!r)throw new Error("Unknown provider");let i;switch((r=Object.assign({},r,o)).oauthType){case"1.0":i=new w(this.$http,this.storage,r,this.options);break;case"2.0":i=new b(this.$http,this.storage,r,this.options);break;default:throw new Error("Invalid OAuth type")}e=i.init(e);if(this.setToken(e,r.tokenPath),this.isAuthenticated())return e;throw new Error("Authentication failed")}async link(t,e,o){var r=this.options.providers[t];if(!r)throw new Error("Unknown provider");let i;switch((r=Object.assign({},r,o)).oauthType){case"1.0":i=new w(this.$http,this.storage,r,this.options);break;case"2.0":i=new b(this.$http,this.storage,r,this.options);break;default:throw new Error("Invalid OAuth type")}const n=i.init(e);return n[this.options.responseDataKey]&&(n=n[this.options.responseDataKey]),n}}let U;return{install(e,o){if(o=o||{},!U){let t=e.config.globalProperties.$http;if(o.axios)t=o.axios;else if(!t)throw new Error("No axios instance found, as option or as vue global");U=new k(t,o),e.config.globalProperties.$auth=U}}}});
//# sourceMappingURL=vue-authenticate.umd.min.js.map
