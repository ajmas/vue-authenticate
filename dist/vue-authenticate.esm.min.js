function camelCase(t){return t.replace(/([\:\-\_]+(.))/g,function(t,e,o,i){return i?o.toUpperCase():o})}function isUndefined(t){return void 0===t}function isObject(t){return null!==t&&"object"==typeof t}function isString(t){return"string"==typeof t}function isFunction(t){return"function"==typeof t}function objectExtend(e,o){return null==e||null==o||Object.keys(o).forEach(function(t){"[object Object]"!=Object.prototype.toString.call(o[t])||"[object Object]"!=Object.prototype.toString.call(e[t])?e[t]=o[t]:e[t]=objectExtend(e[t],o[t])}),e}function joinUrl(t,e){if(/^(?:[a-z]+:)?\/\//i.test(e))return e;return[t,e].join("/").replace(/[\/]+/g,"/").replace(/\/\?/g,"?").replace(/\/\#/g,"#").replace(/\:\//g,"://")}function getFullUrlPath(t){var e="https:"===t.protocol;return t.protocol+"//"+t.hostname+":"+(t.port||(e?"443":"80"))+(/^\//.test(t.pathname)?t.pathname:"/"+t.pathname)}function parseQueryString(t){let e={},o,i;return(t||"").split("&").forEach(t=>{t&&(i=t.split("="),o=decodeURIComponent(i[0]),e[o]=!i[1]||decodeURIComponent(i[1]))}),e}function decodeBase64(t){let e;if("undefined"!=typeof module&&module.exports)try{e=require("buffer").Buffer}catch(t){}let o=String.fromCharCode,i=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),r=function(t){switch(t.length){case 4:var e=((7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3))-65536;return o(55296+(e>>>10))+o(56320+(1023&e));case 3:return o((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return o((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},n=e?function(t){return(t.constructor===e.constructor?t:new e(t,"base64")).toString()}:function(t){return atob(t).replace(i,r)};return n(String(t).replace(/[-_]/g,function(t){return"-"===t?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))}function parseCookies(t=""){if(0===t.length)return{};const o={};var e=new RegExp("\\s*;\\s*");return t.split(e).forEach(t=>{var[e,t]=t.split("="),e=decodeURIComponent(e),t=decodeURIComponent(t);o[e]=t}),o}function formatOptions(t){const{path:e,domain:o,expires:i,secure:r}=t;return[null==e?"":";path="+e,null==o?"":";domain="+o,void 0===i||null===i?"":";expires="+i.toUTCString(),null==r||!1===r?"":";secure"].join("")}function formatCookie(t,e,o){return[encodeURIComponent(t),"=",encodeURIComponent(e),formatOptions(o)].join("")}function getObjectProperty(t,e){let o=void 0,i=t;for(var r=e.split("."),n=0;n<r.length;n++){var s=r[n];if(o=i[s],!isObject(o))break;i=i[s]}return o}"function"!=typeof Object.assign&&(Object.assign=function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var o=Object(t),i=1;i<arguments.length;i++){var r=arguments[i];if(null!=r)for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(o[n]=r[n])}return o});const fakeDocument={createElement(){}},fakeWindow={atob(){},open(){},location:{},localStorage:{setItem(){},getItem(){},removeItem(){}},sessionStorage:{setItem(){},getItem(){},removeItem(){}}},$document=document,$window=window;function getCookieDomainUrl(){try{return $window.location.hostname}catch(t){}return""}function getRedirectUri(t){try{return isUndefined(t)?$window.location.origin:`${$window.location.origin}${t}`}catch(t){}return t||null}var defaultOptions={baseUrl:null,tokenPath:"access_token",tokenName:"token",tokenPrefix:"vueauth",tokenHeader:"Authorization",tokenType:"Bearer",loginUrl:"/auth/login",registerUrl:"/auth/register",logoutUrl:null,storageType:"localStorage",storageNamespace:"vue-authenticate",cookieStorage:{domain:getCookieDomainUrl(),path:"/",secure:!1},requestDataKey:"data",responseDataKey:"data",bindRequestInterceptor:function(e){const o=e.options.tokenHeader;e.$http.interceptors.request.use(t=>(e.isAuthenticated()?t.headers[o]=[e.options.tokenType,e.getToken()].join(" "):delete t.headers[o],t))},providers:{facebook:{name:"facebook",url:"/auth/facebook",authorizationEndpoint:"https://www.facebook.com/v10.0/dialog/oauth",redirectUri:getRedirectUri("/"),requiredUrlParams:["display","scope"],scope:["email"],scopeDelimiter:",",display:"popup",oauthType:"2.0",popupOptions:{width:580,height:400}},google:{name:"google",url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:getRedirectUri(),requiredUrlParams:["scope"],optionalUrlParams:["display"],scope:["profile","email"],scopePrefix:"openid",scopeDelimiter:" ",display:"popup",oauthType:"2.0",popupOptions:{width:452,height:633}},github:{name:"github",url:"/auth/github",authorizationEndpoint:"https://github.com/login/oauth/authorize",redirectUri:getRedirectUri(),optionalUrlParams:["scope"],scope:["user:email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:1020,height:618}},instagram:{name:"instagram",url:"/auth/instagram",authorizationEndpoint:"https://api.instagram.com/oauth/authorize",redirectUri:getRedirectUri(),requiredUrlParams:["scope"],scope:["basic"],scopeDelimiter:"+",oauthType:"2.0",popupOptions:{width:null,height:null}},twitter:{name:"twitter",url:"/auth/twitter",authorizationEndpoint:"https://api.twitter.com/oauth/authenticate",redirectUri:getRedirectUri(),oauthType:"1.0",popupOptions:{width:495,height:645}},bitbucket:{name:"bitbucket",url:"/auth/bitbucket",authorizationEndpoint:"https://bitbucket.org/site/oauth2/authorize",redirectUri:getRedirectUri("/"),optionalUrlParams:["scope"],scope:["email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:1020,height:618}},linkedin:{name:"linkedin",url:"/auth/linkedin",authorizationEndpoint:"https://www.linkedin.com/oauth/v2/authorization",redirectUri:getRedirectUri(),requiredUrlParams:["state"],scope:["r_emailaddress"],scopeDelimiter:" ",state:"STATE",oauthType:"2.0",popupOptions:{width:527,height:582}},live:{name:"live",url:"/auth/live",authorizationEndpoint:"https://login.live.com/oauth20_authorize.srf",redirectUri:getRedirectUri(),requiredUrlParams:["display","scope"],scope:["wl.emails"],scopeDelimiter:" ",display:"popup",oauthType:"2.0",popupOptions:{width:500,height:560}},oauth1:{name:null,url:"/auth/oauth1",authorizationEndpoint:null,redirectUri:getRedirectUri(),oauthType:"1.0",popupOptions:null},oauth2:{name:null,url:"/auth/oauth2",clientId:null,redirectUri:getRedirectUri(),authorizationEndpoint:null,defaultUrlParams:["response_type","client_id","redirect_uri"],requiredUrlParams:null,optionalUrlParams:null,scope:null,scopePrefix:null,scopeDelimiter:null,state:null,oauthType:"2.0",popupOptions:null,responseType:"code",responseParams:{code:"code",clientId:"clientId",redirectUri:"redirectUri"}}}};class CookieStorage{constructor(t){this._defaultOptions=objectExtend({domain:getCookieDomainUrl(),expires:null,path:"/",secure:!1},t)}setItem(t,e){e=formatCookie(t,e,objectExtend({},this._defaultOptions));this._setCookie(e)}getItem(t){const e=parseCookies(this._getCookie());return e.hasOwnProperty(t)?e[t]:null}removeItem(t){var e=objectExtend({},this._defaultOptions),e=formatCookie(t,"",objectExtend(e,{expires:new Date(0)}));this._setCookie(e)}_getCookie(){try{return"undefined"===$document.cookie?"":$document.cookie}catch(t){}return""}_setCookie(t){try{$document.cookie=t}catch(t){}}}class LocalStorage{constructor(t){this.namespace=t||null}setItem(t,e){$window.localStorage.setItem(this._getStorageKey(t),e)}getItem(t){return $window.localStorage.getItem(this._getStorageKey(t))}removeItem(t){$window.localStorage.removeItem(this._getStorageKey(t))}_getStorageKey(t){return this.namespace?[this.namespace,t].join("."):t}}class MemoryStorage{constructor(t){this.namespace=t||null,this._storage={}}setItem(t,e){this._storage[this._getStorageKey(t)]=e}getItem(t){return this._storage[this._getStorageKey(t)]}removeItem(t){delete this._storage[this._getStorageKey(t)]}_getStorageKey(t){return this.namespace?[this.namespace,t].join("."):t}}class SessionStorage{constructor(t){this.namespace=t||null}setItem(t,e){$window.sessionStorage.setItem(this._getStorageKey(t),e)}getItem(t){return $window.sessionStorage.getItem(this._getStorageKey(t))}removeItem(t){$window.sessionStorage.removeItem(this._getStorageKey(t))}_getStorageKey(t){return this.namespace?[this.namespace,t].join("."):t}}function StorageFactory(t){switch(t.storageType){case"localStorage":try{return $window.localStorage.setItem("testKey","test"),$window.localStorage.removeItem("testKey"),new LocalStorage(t.storageNamespace)}catch(t){}case"sessionStorage":try{return $window.sessionStorage.setItem("testKey","test"),$window.sessionStorage.removeItem("testKey"),new SessionStorage(t.storageNamespace)}catch(t){}case"cookieStorage":return new CookieStorage(t.cookieStorage);case"memoryStorage":default:return new MemoryStorage(t.storageNamespace)}}class OAuthPopup{constructor(t,e,o){this.popup=null,this.url=t,this.name=e,this.popupOptions=o}async open(t,e){try{if(this.popup=$window.open(this.url,this.name,this._stringifyOptions()),this.popup&&this.popup.focus&&this.popup.focus(),!e)return this.pooling(t)}catch(t){throw new Error("OAuth popup error occurred")}}async pooling(e){return new Promise((i,r)=>{const t=$document.createElement("a");t.href=e;const n=getFullUrlPath(t);let s=setInterval(()=>{if(!this.popup||this.popup.closed||void 0===this.popup.closed)throw clearInterval(s),s=null,new Error("Auth popup window closed");try{var t,e,o;getFullUrlPath(this.popup.location)===n&&(this.popup.location.search||this.popup.location.hash?(t=parseQueryString(this.popup.location.search.substring(1).replace(/\/$/,"")),e=parseQueryString(this.popup.location.hash.substring(1).replace(/[\/$]/,"")),o=objectExtend({},t),(o=objectExtend(o,e)).error?r(new Error(o.error)):i(o),clearInterval(s),s=null,this.popup.close()):r(new Error("OAuth redirect has occurred but no query or hash parameters were found.")))}catch(t){}},250)})}_stringifyOptions(){let t=[];for(var e in this.popupOptions)isUndefined(this.popupOptions[e])||t.push(`${e}=${this.popupOptions[e]}`);return t.join(",")}}const defaultProviderConfig$1={name:null,url:null,authorizationEndpoint:null,scope:null,scopePrefix:null,scopeDelimiter:null,redirectUri:null,requiredUrlParams:null,defaultUrlParams:null,oauthType:"1.0",popupOptions:{}};class OAuth{constructor(t,e,o,i){this.$http=t,this.storage=e,this.providerConfig=objectExtend({},defaultProviderConfig$1),this.providerConfig=objectExtend(this.providerConfig,o),this.options=i}async init(t){this.oauthPopup=new OAuthPopup("about:blank",this.providerConfig.name,this.providerConfig.popupOptions),$window.cordova||this.oauthPopup.open(this.providerConfig.redirectUri,!0);var e=await this.getRequestToken(),e=await this.openPopup(e);return this.exchangeForToken(e,t)}async getRequestToken(){let t={method:"POST"};return t[this.options.requestDataKey]=objectExtend({},this.providerConfig),t.withCredentials=this.options.withCredentials,this.options.baseUrl?t.url=joinUrl(this.options.baseUrl,this.providerConfig.url):t.url=this.providerConfig.url,this.$http(t)}async openPopup(t){t=[this.providerConfig.authorizationEndpoint,this.buildQueryString(t[this.options.responseDataKey])].join("?");return this.oauthPopup.popup.location=t,$window.cordova?this.oauthPopup.open(this.providerConfig.redirectUri):this.oauthPopup.pooling(this.providerConfig.redirectUri)}async exchangeForToken(t,e){e=objectExtend({},e),e=objectExtend(e,t);let o={method:"POST"};return o[this.options.requestDataKey]=e,o.withCredentials=this.options.withCredentials,this.options.baseUrl?o.url=joinUrl(this.options.baseUrl,this.providerConfig.url):o.url=this.providerConfig.url,this.$http(o)}buildQueryString(t){const e=[];for(var o in t){var i=t[o];e.push(encodeURIComponent(o)+"="+encodeURIComponent(i))}return e.join("&")}}const defaultProviderConfig={name:null,url:null,clientId:null,authorizationEndpoint:null,redirectUri:null,scope:null,scopePrefix:null,scopeDelimiter:null,state:null,requiredUrlParams:null,defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"code",responseParams:{code:"code",clientId:"clientId",redirectUri:"redirectUri"},oauthType:"2.0",popupOptions:{}};class OAuth2{constructor(t,e,o,i){this.$http=t,this.storage=e,this.providerConfig=objectExtend({},defaultProviderConfig),this.providerConfig=objectExtend(this.providerConfig,o),this.options=i}async init(t){var e=this.providerConfig.name+"_state";isFunction(this.providerConfig.state)?this.storage.setItem(e,this.providerConfig.state()):isString(this.providerConfig.state)&&this.storage.setItem(e,this.providerConfig.state);var o=[this.providerConfig.authorizationEndpoint,this._stringifyRequestParams()].join("?");const i=new OAuthPopup(o,this.providerConfig.name,this.providerConfig.popupOptions);o=await i.open(this.providerConfig.redirectUri);if("token"===this.providerConfig.responseType||!this.providerConfig.url)return o;if(o.state&&o.state!==this.storage.getItem(e))throw new Error("State parameter value does not match original OAuth request state value");return this.exchangeForToken(o,t)}exchangeForToken(t,e){let o=objectExtend({},e);for(var i in this.providerConfig.responseParams)switch(this.providerConfig.responseParams[i],i){case"code":o[i]=t.code;break;case"clientId":o[i]=this.providerConfig.clientId;break;case"redirectUri":o[i]=this.providerConfig.redirectUri;break;default:o[i]=t[i]}t.state&&(o.state=t.state);let r;return r=this.options.baseUrl?joinUrl(this.options.baseUrl,this.providerConfig.url):this.providerConfig.url,this.$http.post(r,o,{withCredentials:this.options.withCredentials})}_stringifyRequestParams(){let i=[];return["defaultUrlParams","requiredUrlParams","optionalUrlParams"].forEach(t=>{this.providerConfig[t]&&Array.isArray(this.providerConfig[t])&&this.providerConfig[t].forEach(t=>{var e=camelCase(t);let o=isFunction(this.providerConfig[t])?this.providerConfig[t]():this.providerConfig[e];"redirect_uri"===t&&!o||("state"===t&&(e=this.providerConfig.name+"_state",o=encodeURIComponent(this.storage.getItem(e))),"scope"===t&&Array.isArray(o)&&(o=o.join(this.providerConfig.scopeDelimiter),this.providerConfig.scopePrefix&&(o=[this.providerConfig.scopePrefix,o].join(this.providerConfig.scopeDelimiter))),i.push([t,o]))})}),i.map(t=>t.join("=")).join("&")}}class VueAuthenticate{constructor(t,e){let o=objectExtend({},defaultOptions);o=objectExtend(o,e);let i=StorageFactory(o);if(Object.defineProperties(this,{$http:{get(){return t}},options:{get(){return o}},storage:{get(){return i}},tokenName:{get(){return this.options.tokenPrefix?[this.options.tokenPrefix,this.options.tokenName].join("_"):this.options.tokenName}}}),!this.options.bindRequestInterceptor||!isFunction(this.options.bindRequestInterceptor))throw new Error("Request interceptor must be functions");this.options.bindRequestInterceptor.call(this,this)}isAuthenticated(){let t=this.storage.getItem(this.tokenName);if(t){if(3===t.split(".").length)try{const i=t.split(".")[1];var e=i.replace("-","+").replace("_","/"),o=JSON.parse($window.atob(e)).exp;if("number"==typeof o)return Math.round((new Date).getTime()/1e3)<o}catch(t){return!0}return!0}return!1}getToken(){return this.storage.getItem(this.tokenName)}setToken(t,e){e=getObjectProperty(t=t[this.options.responseDataKey]?t[this.options.responseDataKey]:t,e||this.options.tokenPath);e&&this.storage.setItem(this.tokenName,e)}getPayload(){const t=this.storage.getItem(this.tokenName);if(t&&3===t.split(".").length)try{const o=t.split(".")[1];var e=o.replace("-","+").replace("_","/");return JSON.parse(decodeBase64(e))}catch(t){}}async login(t,e){(e=e||{}).url=e.url||joinUrl(this.options.baseUrl,this.options.loginUrl),e[this.options.requestDataKey]=t||e[this.options.requestDataKey],e.method=e.method||"POST",e.withCredentials=e.withCredentials||this.options.withCredentials;e=this.$http(e);return this.setToken(e),e}async register(t,e){(e=e||{}).url=e.url||joinUrl(this.options.baseUrl,this.options.registerUrl),e[this.options.requestDataKey]=t||e[this.options.requestDataKey],e.method=e.method||"POST",e.withCredentials=e.withCredentials||this.options.withCredentials;e=this.$http(e);return this.setToken(e),e}async logout(t){if(!this.isAuthenticated())throw new Error("There is no currently authenticated user");if((t=t||{}).url||this.options.logoutUrl){t.url=t.url||joinUrl(this.options.baseUrl,this.options.logoutUrl),t.method=t.method||"POST",t[this.options.requestDataKey]=t[this.options.requestDataKey]||void 0,t.withCredentials=t.withCredentials||this.options.withCredentials;t=this.$http(t);return this.storage.removeItem(this.tokenName),t}this.storage.removeItem(this.tokenName)}async authenticate(t,e,o){var i=this.options.providers[t];if(!i)throw new Error("Unknown provider");let r;switch((i=Object.assign({},i,o)).oauthType){case"1.0":r=new OAuth(this.$http,this.storage,i,this.options);break;case"2.0":r=new OAuth2(this.$http,this.storage,i,this.options);break;default:throw new Error("Invalid OAuth type")}e=r.init(e);if(this.setToken(e,i.tokenPath),this.isAuthenticated())return e;throw new Error("Authentication failed")}async link(t,e,o){var i=this.options.providers[t];if(!i)throw new Error("Unknown provider");let r;switch((i=Object.assign({},i,o)).oauthType){case"1.0":r=new OAuth(this.$http,this.storage,i,this.options);break;case"2.0":r=new OAuth2(this.$http,this.storage,i,this.options);break;default:throw new Error("Invalid OAuth type")}const n=r.init(e);return n[this.options.responseDataKey]&&(n=n[this.options.responseDataKey]),n}}let vueAuthInstance;const VueAuthenticatePlugin={install(e,o){if(o=o||{},!vueAuthInstance){let t=e.config.globalProperties.$http;if(o.axios)t=o.axios;else if(!t)throw new Error("No axios instance found, as option or as vue global");vueAuthInstance=new VueAuthenticate(t,o),e.config.globalProperties.$auth=vueAuthInstance}}};export{VueAuthenticatePlugin as default};
//# sourceMappingURL=vue-authenticate.esm.min.js.map
