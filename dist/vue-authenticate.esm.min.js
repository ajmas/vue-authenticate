function t(t){return void 0===t}function e(t){return null!==t&&"object"==typeof t}function o(t){return"function"==typeof t}function i(t,e){return null==t||null==e||Object.keys(e).forEach((function(o){"[object Object]"==Object.prototype.toString.call(e[o])?"[object Object]"!=Object.prototype.toString.call(t[o])?t[o]=e[o]:t[o]=i(t[o],e[o]):t[o]=e[o]})),t}function r(t,e){if(/^(?:[a-z]+:)?\/\//i.test(e))return e;let o=[t,e].join("/");return o.replace(/[\/]+/g,"/").replace(/\/\?/g,"?").replace(/\/\#/g,"#").replace(/\:\//g,"://")}function n(t){const e="https:"===t.protocol;return t.protocol+"//"+t.hostname+":"+(t.port||(e?"443":"80"))+(/^\//.test(t.pathname)?t.pathname:"/"+t.pathname)}function s(t){let e,o,i={};return(t||"").split("&").forEach((t=>{t&&(o=t.split("="),e=decodeURIComponent(o[0]),i[e]=!o[1]||decodeURIComponent(o[1]))})),i}function a(t){let e;if("undefined"!=typeof module&&module.exports)try{e=require("buffer").Buffer}catch(t){}let o=String.fromCharCode,i=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),r=function(t){switch(t.length){case 4:let e=((7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3))-65536;return o(55296+(e>>>10))+o(56320+(1023&e));case 3:return o((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return o((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}};return(e?function(t){return(t.constructor===e.constructor?t:new e(t,"base64")).toString()}:function(t){return atob(t).replace(i,r)})(String(t).replace(/[-_]/g,(function(t){return"-"===t?"+":"/"})).replace(/[^A-Za-z0-9\+\/]/g,""))}function p(t){const{path:e,domain:o,expires:i,secure:r}=t;return[null==e?"":";path="+e,null==o?"":";domain="+o,null==i?"":";expires="+i.toUTCString(),null==r||!1===r?"":";secure"].join("")}function h(t,e,o){return[encodeURIComponent(t),"=",encodeURIComponent(e),p(o)].join("")}"function"!=typeof Object.assign&&(Object.assign=function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var o=Object(t),i=1;i<arguments.length;i++){var r=arguments[i];if(null!=r)for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(o[n]=r[n])}return o});const u=void 0!==typeof document?document:{createElement(){}},l=void 0!==typeof window?window:{atob(){},open(){},location:{},localStorage:{setItem(){},getItem(){},removeItem(){}},sessionStorage:{setItem(){},getItem(){},removeItem(){}}};function c(){try{return l.location.hostname}catch(t){}return""}function d(e){try{return t(e)?l.location.origin:`${l.location.origin}${e}`}catch(t){}return e||null}var g={baseUrl:null,tokenPath:"access_token",tokenName:"token",tokenPrefix:"vueauth",tokenHeader:"Authorization",tokenType:"Bearer",loginUrl:"/auth/login",registerUrl:"/auth/register",logoutUrl:null,storageType:"localStorage",storageNamespace:"vue-authenticate",cookieStorage:{domain:c(),path:"/",secure:!1},requestDataKey:"data",responseDataKey:"data",bindRequestInterceptor:function(t){const e=t.options.tokenHeader;t.$http.interceptors.request.use((o=>(t.isAuthenticated()?o.headers[e]=[t.options.tokenType,t.getToken()].join(" "):delete o.headers[e],o)))},providers:{facebook:{name:"facebook",url:"/auth/facebook",authorizationEndpoint:"https://www.facebook.com/v10.0/dialog/oauth",redirectUri:d("/"),requiredUrlParams:["display","scope"],scope:["email"],scopeDelimiter:",",display:"popup",oauthType:"2.0",popupOptions:{width:580,height:400}},google:{name:"google",url:"/auth/google",authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",redirectUri:d(),requiredUrlParams:["scope"],optionalUrlParams:["display"],scope:["profile","email"],scopePrefix:"openid",scopeDelimiter:" ",display:"popup",oauthType:"2.0",popupOptions:{width:452,height:633}},github:{name:"github",url:"/auth/github",authorizationEndpoint:"https://github.com/login/oauth/authorize",redirectUri:d(),optionalUrlParams:["scope"],scope:["user:email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:1020,height:618}},instagram:{name:"instagram",url:"/auth/instagram",authorizationEndpoint:"https://api.instagram.com/oauth/authorize",redirectUri:d(),requiredUrlParams:["scope"],scope:["basic"],scopeDelimiter:"+",oauthType:"2.0",popupOptions:{width:null,height:null}},twitter:{name:"twitter",url:"/auth/twitter",authorizationEndpoint:"https://api.twitter.com/oauth/authenticate",redirectUri:d(),oauthType:"1.0",popupOptions:{width:495,height:645}},bitbucket:{name:"bitbucket",url:"/auth/bitbucket",authorizationEndpoint:"https://bitbucket.org/site/oauth2/authorize",redirectUri:d("/"),optionalUrlParams:["scope"],scope:["email"],scopeDelimiter:" ",oauthType:"2.0",popupOptions:{width:1020,height:618}},linkedin:{name:"linkedin",url:"/auth/linkedin",authorizationEndpoint:"https://www.linkedin.com/oauth/v2/authorization",redirectUri:d(),requiredUrlParams:["state"],scope:["r_emailaddress"],scopeDelimiter:" ",state:"STATE",oauthType:"2.0",popupOptions:{width:527,height:582}},live:{name:"live",url:"/auth/live",authorizationEndpoint:"https://login.live.com/oauth20_authorize.srf",redirectUri:d(),requiredUrlParams:["display","scope"],scope:["wl.emails"],scopeDelimiter:" ",display:"popup",oauthType:"2.0",popupOptions:{width:500,height:560}},oauth1:{name:null,url:"/auth/oauth1",authorizationEndpoint:null,redirectUri:d(),oauthType:"1.0",popupOptions:null},oauth2:{name:null,url:"/auth/oauth2",clientId:null,redirectUri:d(),authorizationEndpoint:null,defaultUrlParams:["response_type","client_id","redirect_uri"],requiredUrlParams:null,optionalUrlParams:null,scope:null,scopePrefix:null,scopeDelimiter:null,state:null,oauthType:"2.0",popupOptions:null,responseType:"code",responseParams:{code:"code",clientId:"clientId",redirectUri:"redirectUri"}}}};class m{constructor(t){this._defaultOptions=i({domain:c(),expires:null,path:"/",secure:!1},t)}setItem(t,e){const o=h(t,e,i({},this._defaultOptions));this._setCookie(o)}getItem(t){const e=function(t=""){if(0===t.length)return{};const e={},o=new RegExp("\\s*;\\s*");return t.split(o).forEach((t=>{const[o,i]=t.split("="),r=decodeURIComponent(o),n=decodeURIComponent(i);e[r]=n})),e}(this._getCookie());return e.hasOwnProperty(t)?e[t]:null}removeItem(t){const e=i({},this._defaultOptions),o=h(t,"",i(e,{expires:new Date(0)}));this._setCookie(o)}_getCookie(){try{return"undefined"===u.cookie?"":u.cookie}catch(t){}return""}_setCookie(t){try{u.cookie=t}catch(t){}}}class f{constructor(t){this.namespace=t||null}setItem(t,e){l.localStorage.setItem(this._getStorageKey(t),e)}getItem(t){return l.localStorage.getItem(this._getStorageKey(t))}removeItem(t){l.localStorage.removeItem(this._getStorageKey(t))}_getStorageKey(t){return this.namespace?[this.namespace,t].join("."):t}}class y{constructor(t){this.namespace=t||null,this._storage={}}setItem(t,e){this._storage[this._getStorageKey(t)]=e}getItem(t){return this._storage[this._getStorageKey(t)]}removeItem(t){delete this._storage[this._getStorageKey(t)]}_getStorageKey(t){return this.namespace?[this.namespace,t].join("."):t}}class w{constructor(t){this.namespace=t||null}setItem(t,e){l.sessionStorage.setItem(this._getStorageKey(t),e)}getItem(t){return l.sessionStorage.getItem(this._getStorageKey(t))}removeItem(t){l.sessionStorage.removeItem(this._getStorageKey(t))}_getStorageKey(t){return this.namespace?[this.namespace,t].join("."):t}}class v{constructor(t,e,o){this.popup=null,this.url=t,this.name=e,this.popupOptions=o}async open(t,e){try{if(this.popup=l.open(this.url,this.name,this._stringifyOptions()),this.popup&&this.popup.focus&&this.popup.focus(),!e)return this.pooling(t)}catch(t){throw new Error("OAuth popup error occurred")}}async pooling(t){const e=u.createElement("a");e.href=t;const o=n(e);let r=setInterval((()=>{if(!this.popup||this.popup.closed||void 0===this.popup.closed)throw clearInterval(r),r=null,new Error("Auth popup window closed");try{if(n(this.popup.location)===o){if(this.popup.location.search||this.popup.location.hash){const t=s(this.popup.location.search.substring(1).replace(/\/$/,"")),e=s(this.popup.location.hash.substring(1).replace(/[\/$]/,""));let o=i({},t);if(o=i(o,e),o.error)throw new Error(o.error);return o}throw new Error("OAuth redirect has occurred but no query or hash parameters were found.")}}catch(t){}finally{clearInterval(r),r=null,this.popup.close()}}),250)}_stringifyOptions(){let e=[];for(var o in this.popupOptions)t(this.popupOptions[o])||e.push(`${o}=${this.popupOptions[o]}`);return e.join(",")}}const C={name:null,url:null,authorizationEndpoint:null,scope:null,scopePrefix:null,scopeDelimiter:null,redirectUri:null,requiredUrlParams:null,defaultUrlParams:null,oauthType:"1.0",popupOptions:{}};class b{constructor(t,e,o,r){this.$http=t,this.storage=e,this.providerConfig=i({},C),this.providerConfig=i(this.providerConfig,o),this.options=r}async init(t){this.oauthPopup=new v("about:blank",this.providerConfig.name,this.providerConfig.popupOptions),l.cordova||this.oauthPopup.open(this.providerConfig.redirectUri,!0);const e=await this.getRequestToken(),o=await this.openPopup(e);return this.exchangeForToken(o,t)}async getRequestToken(){let t={method:"POST"};return t[this.options.requestDataKey]=i({},this.providerConfig),t.withCredentials=this.options.withCredentials,this.options.baseUrl?t.url=r(this.options.baseUrl,this.providerConfig.url):t.url=this.providerConfig.url,this.$http(t)}async openPopup(t){const e=[this.providerConfig.authorizationEndpoint,this.buildQueryString(t[this.options.responseDataKey])].join("?");return this.oauthPopup.popup.location=e,l.cordova?this.oauthPopup.open(this.providerConfig.redirectUri):this.oauthPopup.pooling(this.providerConfig.redirectUri)}async exchangeForToken(t,e){let o=i({},e);o=i(o,t);let n={method:"POST"};return n[this.options.requestDataKey]=o,n.withCredentials=this.options.withCredentials,this.options.baseUrl?n.url=r(this.options.baseUrl,this.providerConfig.url):n.url=this.providerConfig.url,this.$http(n)}buildQueryString(t){const e=[];for(var o in t){let i=t[o];e.push(encodeURIComponent(o)+"="+encodeURIComponent(i))}return e.join("&")}}const k={name:null,url:null,clientId:null,authorizationEndpoint:null,redirectUri:null,scope:null,scopePrefix:null,scopeDelimiter:null,state:null,requiredUrlParams:null,defaultUrlParams:["response_type","client_id","redirect_uri"],responseType:"code",responseParams:{code:"code",clientId:"clientId",redirectUri:"redirectUri"},oauthType:"2.0",popupOptions:{}};class U{constructor(t,e,o,r){this.$http=t,this.storage=e,this.providerConfig=i({},k),this.providerConfig=i(this.providerConfig,o),this.options=r}async init(t){let e=this.providerConfig.name+"_state";o(this.providerConfig.state)?this.storage.setItem(e,this.providerConfig.state()):"string"==typeof this.providerConfig.state&&this.storage.setItem(e,this.providerConfig.state);let i=[this.providerConfig.authorizationEndpoint,this._stringifyRequestParams()].join("?");this.oauthPopup=new v(i,this.providerConfig.name,this.providerConfig.popupOptions);const r=await oauthPopup.open(this.providerConfig.redirectUri);if("token"===this.providerConfig.responseType||!this.providerConfig.url)return r;if(r.state&&r.state!==this.storage.getItem(e))throw new Error("State parameter value does not match original OAuth request state value");return this.exchangeForToken(r,t)}exchangeForToken(t,e){let o,n=i({},e);for(let e in this.providerConfig.responseParams)switch(this.providerConfig.responseParams[e],e){case"code":n[e]=t.code;break;case"clientId":n[e]=this.providerConfig.clientId;break;case"redirectUri":n[e]=this.providerConfig.redirectUri;break;default:n[e]=t[e]}return t.state&&(n.state=t.state),o=this.options.baseUrl?r(this.options.baseUrl,this.providerConfig.url):this.providerConfig.url,this.$http.post(o,n,{withCredentials:this.options.withCredentials})}_stringifyRequestParams(){let t=[];return["defaultUrlParams","requiredUrlParams","optionalUrlParams"].forEach((e=>{this.providerConfig[e]&&Array.isArray(this.providerConfig[e])&&this.providerConfig[e].forEach((e=>{let i=e.replace(/([\:\-\_]+(.))/g,(function(t,e,o,i){return i?o.toUpperCase():o}));let r=o(this.providerConfig[e])?this.providerConfig[e]():this.providerConfig[i];if("redirect_uri"!==e||r){if("state"===e){let t=this.providerConfig.name+"_state";r=encodeURIComponent(this.storage.getItem(t))}"scope"===e&&Array.isArray(r)&&(r=r.join(this.providerConfig.scopeDelimiter),this.providerConfig.scopePrefix&&(r=[this.providerConfig.scopePrefix,r].join(this.providerConfig.scopeDelimiter))),t.push([e,r])}}))})),t.map((t=>t.join("="))).join("&")}}class I{constructor(t,e){let r=i({},g);r=i(r,e);let n=function(t){switch(t.storageType){case"localStorage":try{return l.localStorage.setItem("testKey","test"),l.localStorage.removeItem("testKey"),new f(t.storageNamespace)}catch(t){}case"sessionStorage":try{return l.sessionStorage.setItem("testKey","test"),l.sessionStorage.removeItem("testKey"),new w(t.storageNamespace)}catch(t){}case"cookieStorage":return new m(t.cookieStorage);default:return new y(t.storageNamespace)}}(r);if(Object.defineProperties(this,{$http:{get:()=>t},options:{get:()=>r},storage:{get:()=>n},tokenName:{get(){return this.options.tokenPrefix?[this.options.tokenPrefix,this.options.tokenName].join("_"):this.options.tokenName}}}),!this.options.bindRequestInterceptor||!o(this.options.bindRequestInterceptor))throw new Error("Request interceptor must be functions");this.options.bindRequestInterceptor.call(this,this)}isAuthenticated(){let t=this.storage.getItem(this.tokenName);if(t){if(3===t.split(".").length)try{const e=t.split(".")[1].replace("-","+").replace("_","/"),o=JSON.parse(l.atob(e)).exp;if("number"==typeof o)return Math.round((new Date).getTime()/1e3)<o}catch(t){return!0}return!0}return!1}getToken(){return this.storage.getItem(this.tokenName)}setToken(t,o){t[this.options.responseDataKey]&&(t=t[this.options.responseDataKey]);const i=function(t,o){let i,r=t;const n=o.split(".");for(var s=0;s<n.length;s++){const t=n[s];if(i=r[t],!e(i))break;r=r[t]}return i}(t,o||this.options.tokenPath);i&&this.storage.setItem(this.tokenName,i)}getPayload(){const t=this.storage.getItem(this.tokenName);if(t&&3===t.split(".").length)try{const e=t.split(".")[1].replace("-","+").replace("_","/");return JSON.parse(a(e))}catch(t){}}async login(t,e){(e=e||{}).url=e.url?e.url:r(this.options.baseUrl,this.options.loginUrl),e[this.options.requestDataKey]=t||e[this.options.requestDataKey],e.method=e.method||"POST",e.withCredentials=e.withCredentials||this.options.withCredentials;const o=this.$http(e);return this.setToken(o),o}async register(t,e){(e=e||{}).url=e.url?e.url:r(this.options.baseUrl,this.options.registerUrl),e[this.options.requestDataKey]=t||e[this.options.requestDataKey],e.method=e.method||"POST",e.withCredentials=e.withCredentials||this.options.withCredentials;const o=this.$http(e);return this.setToken(o),o}async logout(t){if(!this.isAuthenticated())throw new Error("There is no currently authenticated user");if((t=t||{}).url||this.options.logoutUrl){t.url=t.url?t.url:r(this.options.baseUrl,this.options.logoutUrl),t.method=t.method||"POST",t[this.options.requestDataKey]=t[this.options.requestDataKey]||void 0,t.withCredentials=t.withCredentials||this.options.withCredentials;const e=this.$http(t);return this.storage.removeItem(this.tokenName),e}this.storage.removeItem(this.tokenName)}async authenticate(t,e,o){let i,r=this.options.providers[t];if(!r)throw new Error("Unknown provider");switch(r=Object.assign({},r,o),r.oauthType){case"1.0":i=new b(this.$http,this.storage,r,this.options);break;case"2.0":i=new U(this.$http,this.storage,r,this.options);break;default:throw new Error("Invalid OAuth type")}const n=i.init(e);if(this.setToken(n,r.tokenPath),this.isAuthenticated())return n;throw new Error("Authentication failed")}async link(t,e,o){let i,r=this.options.providers[t];if(!r)throw new Error("Unknown provider");switch(r=Object.assign({},r,o),r.oauthType){case"1.0":i=new b(this.$http,this.storage,r,this.options);break;case"2.0":i=new U(this.$http,this.storage,r,this.options);break;default:throw new Error("Invalid OAuth type")}const n=i.init(e);return n[this.options.responseDataKey]&&(n=n[this.options.responseDataKey]),n}}let P;const O={install(t,e){if(e||(e={}),!P){let o=t.config.globalProperties.$http;if(e.axios)o=e.axios;else if(!o)throw new Error("No axios instance found, as option or as vue global");P=new I(o,e),t.config.globalProperties.$auth=P}}};export{O as default};
